---
title       : When road accidents took a place in Finland 2015
subtitle    : Reactive shiny application
author      : vtenhunen
job         : 
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : []            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
---

## Contents of the app

App include following information:

1. Monthly accidents; Is there any month more dangerous in traffic tha other?
2. Daily daily accidents; How many accidents we have in Finland daily?
3. Hourly accidents; What is the time of the day when the most of accidents took a place

Data comes from Finnish Transport Agency which collects annual road trafic accident data. It is based on information received from the law enforcement officials and Statistics Finland and it is openly published in Avoindata.fi: http://tinyurl.com/zk2fshn

--- .class #id 

## Sample 1: Daily plot

Number of daily accidents slightly increased untile the of the year 2015.

```{r daily, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE, fig.height = 6, fig.align = 'center'}
library(dplyr)
library(lubridate)
library(ggplot2)

      # make sure that we have right locale here
#      Sys.setlocale("LC_TIME","en_US.UTF-8")
      
      # Let's have the Finnish road accident 2015 data
      DataURL2015="https://www.avoindata.fi/dataset/35f439f6-4512-444f-afd1-444356cb9524/resource/df40544f-7967-4224-8f02-6e0543f2e623/download/Tieliikenneonnettomuudet2015.zip"
      DataFile2015="./RoadTrafficAccidentsIn2015.zip"
      
      if(!file.exists(DataFile2015)){
            # Get the data for the assignment
            download.file(DataURL2015, DataFile2015)
      }
      
      # It is a zip packet, so we unzip it
      unzip(DataFile2015)
      
      # Next we read the data to the data frame 
      alldata2015 = read.csv("./Tieliikenneonnettomuudet_2015/tieliikenneonnettomuudet_2015_onnettomuus.csv", na.strings="NA", sep = ";", header = TRUE, fileEncoding = "latin1")
      
      # let's take only some columns:
      acd2015 <- select(alldata2015, Onnett_id, Vuosi, Kk, P채iv채, Tunti, Vakavuusko, X, Y, Kuolleet, Loukkaant)
      
      # Rename columns, Finnish ones are not so informative
      colnames(acd2015)[1] <- "Accident_id" # Onnett_id
      colnames(acd2015)[2] <- "Year" # Vuosi
      colnames(acd2015)[3] <- "Month" # Kk
      colnames(acd2015)[4] <- "Date" # P채iv채
      colnames(acd2015)[5] <- "Hour" # Tunti
      colnames(acd2015)[6] <- "Seriousness" # Vakavuusko
      colnames(acd2015)[7] <- "X" # X
      colnames(acd2015)[8] <- "Y" # Y
      colnames(acd2015)[9] <- "Deaths" # Kuolleet
      colnames(acd2015)[10] <- "Injuries" # Loukkaant
      
      # Remove NA-information
      acd2015 <- acd2015[complete.cases(acd2015),]
      
      # Now we convert the day format to the standard format 
      acd2015$Date <- as.Date(parse_date_time(acd2015$Date,"dmy"))

      ## Here we calculate accident frequenses, deads and injured by month
#      accbymonth <- acd2015 %>%
#            group_by(Month) %>%
#            summarise(freq = n(), dead = sum(Deaths), injured = sum(Injuries)) 
      
      ## Here we calculate accident frequenses, deads and injured by day
      accbyday <- acd2015 %>%
            group_by(Date) %>%
            summarise(freq = n(), dead = sum(Deaths), injured = sum(Injuries)) 
      
      ## Now we calculate accident per hour of the day
      accbyhour <- acd2015 %>%
            group_by(Hour) %>%
            summarise(freq = n(), dead = sum(Deaths), injured = sum(Injuries)) 
      # clean -1 hour away, don't know why it is in the data
      accbyhour<-accbyhour[!(accbyhour$Hour=="-1"),]

                  #Here we do ggplot
                  p <- ggplot(accbyday, aes(x=Date, y=freq)) +
                        geom_point(shape=1, color="blue") + 
                        # here we do lm
                        geom_smooth(method=lm) + 
                        ggtitle("Accidents daily") +      
                        labs(x="Day", y="")
                  p

```

--- .class #id 

## Sample 2: Which are the most dangerous hours on the roads? 

It is not morgning, it is afternoon.

```{r hourly, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE, fig.height = 6, fig.align = 'center'}

                  #Here we do ggplot
                  p <- ggplot(accbyhour, aes(x=Hour, y=freq)) +
                        geom_line(aes(colour = freq)) + 
                        geom_point(shape=1) + 
                        scale_colour_gradient(low="blue",high="red") +
                        scale_x_continuous(name = "Hour of the day",
                                           # layout need this 0 and 13
                                           breaks = seq(1, 24, 1),
                                           limits=c(1, 24))+
                        ggtitle("Accidents hourly") +
                        labs(x="Hour", y="")
                  p

```

--- .class #id 

## Where you can find it?


- You can find the free and open reactive shiny application from Shinyapps.io: https://vtenhunen.shinyapps.io/DDP_Course_Project/
- Source code of the app is in the GitHub: https://github.com/vtenhunen/DDP_Course_Project
